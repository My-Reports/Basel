<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Excel Dashboard</title>
<link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
</head>
<body>
<h2>Excel Dashboard</h2>

<input type="text" id="excelUrl" placeholder="https://github.com/My-Reports/Basel/raw/refs/heads/main/gittest.xlsx" style="width:50%;">
<button onclick="loadExcel()">Load Excel</button>

<div id="table"></div>
<div id="charts" style="display:flex; flex-wrap:wrap; margin-top:20px;">
  <div id="barChart" style="width:600px;height:400px;"></div>
  <div id="pieChart" style="width:600px;height:400px;"></div>
</div>

<script>
let table;

async function loadExcel() {
    const url = document.getElementById('excelUrl').value;
    const data = await fetch(url).then(res => res.arrayBuffer());
    const workbook = XLSX.read(data, {type:"array"});
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const jsonData = XLSX.utils.sheet_to_json(sheet);

    // إنشاء الجدول التفاعلي
    table = new Tabulator("#table", {
        data: jsonData,
        layout:"fitDataStretch",
        pagination:"local",
        paginationSize:20,
        movableColumns:true,
        columns: Object.keys(jsonData[0]).map(col => ({
            title: col, field: col, headerFilter:"input"
        }))
    });

    // رسم Charts
    createCharts(jsonData);
}

function createCharts(data) {
    // مثال: Bar chart للقيمة حسب SKU
    const skuNames = data.map(d => d["SKU"]);
    const values = data.map(d => d["Value"]);

    Plotly.newPlot('barChart', [{
        x: skuNames,
        y: values,
        type:'bar'
    }], {title:"Value per SKU"});

    // مثال: Pie chart حسب المدينة
    const cityCount = {};
    data.forEach(d => {
        const city = d["City"] || "Unknown";
        cityCount[city] = (cityCount[city] || 0) + (d["Qty"] || 0);
    });

    Plotly.newPlot('pieChart', [{
        values: Object.values(cityCount),
        labels: Object.keys(cityCount),
        type:'pie'
    }], {title:"Quantity by City"});
}
</script>
</body>
</html>
